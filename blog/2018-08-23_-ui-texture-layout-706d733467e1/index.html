<!doctype html><html>
<head>
<title>비동기 UI 업데이트가 Texture가 Layout을 계산하는 과정을 방해한다. // Geektree0101</title>
<meta charset=utf-8>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<meta name=description content="위의 UI결과화면은 didLoad 되기 전에 setNeedsLayout을 호출 할 경우 bounds가 최초 또는 Pended Layout Bounds로 처리되는 현상입니다.">
<meta property="og:title" content="비동기 UI 업데이트가 Texture가 Layout을 계산하는 과정을 방해한다.">
<meta property="og:description" content>
<meta property="og:type" content="website">
<meta property="og:locale" content="en">
<meta property="og:url" content="/blog/2018-08-23_-ui-texture-layout-706d733467e1/">
<link rel="shortcut icon" href=/favicon.ico>
<link href=webfonts/ptserif/main.css rel=stylesheet type=text/css>
<link href=webfonts/source-code-pro/main.css rel=stylesheet type=text/css>
<link rel=stylesheet href=css/style.css>
<meta name=generator content="Hugo 0.91.2">
</head>
<body>
<div id=container>
<header id=header>
<div id=header-outer class=outer>
<div id=header-inner class=inner>
<a id=main-nav-toggle class=nav-icon href=javascript:;></a>
<a id=logo class=logo-text href=/>Geektree0101</a>
<nav id=main-nav>
<a class=main-nav-link href=/about>About</a>
<a class=main-nav-link href=/categories>Categories</a>
<a class=main-nav-link href=/tags>Tags</a>
</nav>
<nav id=sub-nav>
<div id=search-form-wrap>
</div>
</nav>
</div>
</div>
</header>
<section id=main class=outer>
<article class="article article-type-post" itemscope itemprop=blogPost>
<div class=article-inner>
<header class=article-header>
<h1 class=article-title itemprop=name>비동기 UI 업데이트가 Texture가 Layout을 계산하는 과정을 방해한다.</h1>
</header>
<div class=article-meta>
<a href=/blog/2018-08-23_-ui-texture-layout-706d733467e1/ class=article-date>
<time datetime=2018-08-23T00:04:46.069+00:00 itemprop=datePublished>2018-08-23</time>
</a>
<div class=post-categories>
<div class=article-category>
<a class=article-category-link href=/categories/ios>iOS</a>
</div>
</div>
</div>
<div class=article-entry itemprop=articleBody>
<p><img src=/images/blog/1__Oz3CKq9GbNodbXn84W2XbA.png alt>
<img src=/images/blog/0__mQndCdgFuSWh4n__Q.png alt></p>
<p>위의 UI결과화면은 didLoad 되기 전에 setNeedsLayout을 호출 할 경우 bounds가 최초 또는 Pended Layout Bounds로 처리되는 현상입니다.</p>
<p>이후 setNeedsLayout을 호출해도 변하지 않습니다.</p>
<p><strong>Texture 2.7이후에서만 발생하는 이슈입니다.</strong></p>
<p>위의 현상에 대한 ViewModel과 Model을 확인해봅시다. 코드는 다음과 같습니다.</p>
<p><img src=/images/blog/1__sw9SSVDCa__A__hgQc2z43eA.png alt>
<img src=/images/blog/1__o10meKq5Guralv__CxU5FTg.png alt></p>
<p><img src=/images/blog/1__wISw4ic19m__LRYjGjQlN8g.png alt></p>
<p>setNeedsLayout은 attribute가 바뀌었을 때 Layout을 다시계산 하기 위함입니다.</p>
<p>하지만 실제 binding되는 시점은 init이 완료되기 전에 다 된다고 보장 못합니다. 비동기적으로 처리되기 때문입니다.</p>
<p>이것이 didLoad 이전 시점에서 binding을 처리하게 되면 setNeedsLayout을 호출하게 되고 더 이상 bounds가 변하지 않게 됩니다.</p>
<p><a href=https://medium.com/@h2s1880/texture-2-7-rxswift%EC%99%80-setneedslayout%EC%97%90-%EB%8C%80%ED%95%9C-%EA%B3%A0%EC%B0%B0-298609b85e1f title=https://medium.com/@h2s1880/texture-2-7-rxswift%EC%99%80-setneedslayout%EC%97%90-%EB%8C%80%ED%95%9C-%EA%B3%A0%EC%B0%B0-298609b85e1f><strong>Texture 2.7: RxSwift와 setNeedsLayout에 대한 고찰</strong><br>
_Texture 2.7에서 많은 변화가 있었습니다. iOS 11 iPhoneX safeArea를 node 어디서든 적용할 수 있게 되었을 뿐만 아니라 전반적으로 퍼포먼스가 상향되었습니다._medium.com</a><a href=https://medium.com/@h2s1880/texture-2-7-rxswift%EC%99%80-setneedslayout%EC%97%90-%EB%8C%80%ED%95%9C-%EA%B3%A0%EC%B0%B0-298609b85e1f></a></p>
<p>물론 위의 내용과 같이 처리하는 법도 있지만 Texture2.6 때랑 비교하면 매우 슬픈 일입니다.</p>
<p>네트워크작업이나 시간이 다소 필요한 UI Observable를 제외한 단순 Model Property 참초하는 Observable를 굳이 init시점에서 비동기적으로 바인딩을 할 필요는 있는지 생각을 해봅니다.</p>
<p>저는 Observable대신 BehaviorRelay를 이용해서 Value값이 있는 경우 그 즉시 Binding을 처리하도록 Binder를 Customize하였습니다. 코드는 아래와 같습니다.</p>
<p><img src=/images/blog/1__PFZ7DxPwVJpEqtdd2bTF8Q.png alt>
<img src=/images/blog/1__wISw4ic19m__LRYjGjQlN8g.png alt></p>
<p><img src=/images/blog/1__ZnUL5w__ntk__Ax5iuu9ai1A.png alt>
<img src=/images/blog/1____cUbrkySLIte8U1CIiX7dA.png alt></p>
<p><img src=/images/blog/1__w6CQgov7azRoOC1Yvde7DQ.png alt>
<img src=/images/blog/1__OCsZwh1airQ2jgjD1ShFog.png alt></p>
<p><img src=/images/blog/1__VkEcQZGZ__bCB2d3x7x1I0w.png alt></p>
<p>이 방법또한 최선의 방법은 아닐껍니다. 아마 다음에 다루게 될 내용은 <a href=http://texturegroup.org/docs/intelligent-preloading.html>http://texturegroup.org/docs/intelligent-preloading.html</a> 를 이용해서 처리할 수 있는 방법에 대해서 생각해볼 예정입니다.</p>
</div>
<div class=article-toc>
<h3>Contents</h3>
<nav id=TableOfContents></nav>
</div>
<footer class=article-footer>
<ul class=article-tag-list>
<li class=article-tag-list-item>
<a class=article-tag-list-link href=tags/ios>ios
</a>
</li>
<li class=article-tag-list-item>
<a class=article-tag-list-link href=tags/texture>texture
</a>
</li>
</ul>
</footer>
</div>
<nav id=article-nav>
<a href=/blog/2018-08-26_ios-storybook-with-texture-56608805b981/ id=article-nav-newer class=article-nav-link-wrap>
<div class=article-nav-title><span>&lt;</span>&nbsp;
iOS Storybook with Texture
</div>
</a>
<a href=/blog/2018-08-11_model-view-intent-with-texture-3ce1b4e01b1e/ id=article-nav-older class=article-nav-link-wrap>
<div class=article-nav-title>Model-View-Intent with Texture&nbsp;<span>></span></div>
</a>
</nav>
</article>
</section>
<footer id=footer>
<div class=outer>
<div id=footer-info class=inner>
&copy; 2022 Geektree0101
<br>
Powered by <a href=https://gohugo.io target=_blank>Hugo</a> with theme <a href=https://github.com/carsonip/hugo-theme-minos target=_blank>Minos</a>
</div>
</div>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/tomorrow-night.min.css integrity="sha256-2wL88NKUqvJi/ExflDzkzUumjUM73mcK2gBvBBeLvTk=" crossorigin=anonymous>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js integrity="sha256-KbfTjB0WZ8vvXngdpJGY3Yp3xKk+tttbqClO11anCIU=" crossorigin=anonymous></script>
<script>hljs.initHighlightingOnLoad()</script>
<script>document.getElementById('main-nav-toggle').addEventListener('click',function(){var a=document.getElementById('header');a.classList.contains('mobile-on')?a.classList.remove('mobile-on'):a.classList.add('mobile-on')})</script>
</footer>
</div>
</body>
</html>