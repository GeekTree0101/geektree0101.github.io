<!doctype html><html dir=ltr lang=en data-theme class=html><head><title>Geektree0101
|
VEditorKit: Lightweight and Powerful Editor Kit (Part 1. NSTextStorage)</title><meta charset=utf-8><meta name=generator content="Hugo 0.101.0"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=author content="Geektree0101"><meta name=description content="Lightweight and Powerful Editor Kit built on Texture"><link rel=stylesheet href=/scss/main.min.b2e0cb07595e3519ab1193bb421914e06c0e26b0cc561fef23b3c6131d4d2ffa.css integrity="sha256-suDLB1leNRmrEZO7QhkU4GwOJrDMVh/vI7PGEx1NL/o=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/markupHighlight.min.31b0a1f317f55c529a460897848c97436bb138b19c399b37de70d463a8bf6ed5.css integrity="sha256-MbCh8xf1XFKaRgiXhIyXQ2uxOLGcOZs33nDUY6i/btU=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/fontawesome.min.b1c4e6a10bdbab01f33fff9d78816ee68cf9a9a731f07668afd546a79924cb80.css integrity="sha256-scTmoQvbqwHzP/+deIFu5oz5qacx8HZor9VGp5kky4A=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/solid.min.423dee17c62f55fa733a4ee13e00d523dfce88cc4f4ab4549a24ba36bd9de681.css integrity="sha256-Qj3uF8YvVfpzOk7hPgDVI9/OiMxPSrRUmiS6Nr2d5oE=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/brands.min.b7d54133b27e5b4de15245b8e143de3e8ed2d674c706137274cedc9953f31917.css integrity="sha256-t9VBM7J+W03hUkW44UPePo7S1nTHBhNydM7cmVPzGRc=" crossorigin=anonymous type=text/css><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=canonical href=https://geektree0101.github.io/blog/blog19/><script type=text/javascript src=/js/anatole-header.min.f9132794301a01ff16550ed66763482bd848f62243d278f5e550229a158bfd32.js integrity="sha256-+RMnlDAaAf8WVQ7WZ2NIK9hI9iJD0nj15VAimhWL/TI=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/anatole-theme-switcher.min.738c0e3a493854876aeab9e2316fd43f1936aeeac4cc6b3e60bb26456dba72ad.js integrity="sha256-c4wOOkk4VIdq6rniMW/UPxk2rurEzGs+YLsmRW26cq0=" crossorigin=anonymous></script><meta name=twitter:card content="summary"><meta name=twitter:title content="VEditorKit: Lightweight and Powerful Editor Kit (Part 1.  NSTextStorage)"><meta name=twitter:description content="Lightweight and Powerful Editor Kit built on Texture"><meta property="og:title" content="VEditorKit: Lightweight and Powerful Editor Kit (Part 1.  NSTextStorage)"><meta property="og:description" content="Lightweight and Powerful Editor Kit built on Texture"><meta property="og:type" content="article"><meta property="og:url" content="https://geektree0101.github.io/blog/blog19/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2019-01-20T04:23:30+00:00"><meta property="article:modified_time" content="2019-01-20T04:23:30+00:00"><meta property="og:site_name" content="Hyeonsu Ha"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"blog","name":"VEditorKit: Lightweight and Powerful Editor Kit (Part 1.  NSTextStorage)","headline":"VEditorKit: Lightweight and Powerful Editor Kit (Part 1.  NSTextStorage)","alternativeHeadline":"","description":"
      Lightweight and Powerful Editor Kit built on Texture


    ","inLanguage":"en-us","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/geektree0101.github.io\/blog\/blog19\/"},"author":{"@type":"Person","name":"Geektree0101"},"creator":{"@type":"Person","name":"Geektree0101"},"accountablePerson":{"@type":"Person","name":"Geektree0101"},"copyrightHolder":{"@type":"Person","name":"Geektree0101"},"copyrightYear":"2019","dateCreated":"2019-01-20T04:23:30.38Z","datePublished":"2019-01-20T04:23:30.38Z","dateModified":"2019-01-20T04:23:30.38Z","publisher":{"@type":"Organization","name":"Geektree0101","url":"https://geektree0101.github.io/","logo":{"@type":"ImageObject","url":"https:\/\/geektree0101.github.io\/favicon-32x32.png","width":"32","height":"32"}},"image":[],"url":"https:\/\/geektree0101.github.io\/blog\/blog19\/","wordCount":"534","genre":["iOS"],"keywords":["ios","vingle","VEditorKit"]}</script></head><body class="body theme--light"><div class=wrapper><aside class=wrapper__sidebar><div class="sidebar
animated fadeInDown"><div class=sidebar__content><div class=sidebar__introduction><img class=sidebar__introduction-profileimage src="https://avatars.githubusercontent.com/u/19504988?v=4" alt="profile picture"><div class=sidebar__introduction-title><a href=/>Hyeonsu Ha</a></div><div class=sidebar__introduction-description><p>엔지니어링의 근본은 문제해결이며<br>저에게 있어서 문제에 대한 해결과 해결에 따른 새로운 문제는 놀이이자 즐거움입니다.<br>문제해결을 위한 빠른 프로토 타이핑과 제품 실현화를 즐기며,<br>이 과정에서 함께하는 동료들과 지속적으로 성장가능한 협업 문화를 추구합니다.<br><br>#Geektree0101 #David #iOS #Gopher #Karrot #당근마켓 #Vingle #MIRO<br></p></div></div><ul class=sidebar__list><li class=sidebar__list-item><a href=https://www.linkedin.com/in/hyeonsu-ha-7ba02b112/ target=_blank rel=noopener aria-label=Linkedin title=Linkedin><i class="fab fa-linkedin fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=h2s1880@gmail.com target=_blank rel=noopener aria-label=e-mail title=e-mail><i class="fas fa-envelope fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://github.com/GeekTree0101 target=_blank rel=noopener aria-label=github title=github><i class="fab fa-github fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://www.instagram.com/geektree0101/ target=_blank rel=noopener aria-label=instagram title=instagram><i class="fab fa-instagram fa-2x" aria-hidden=true></i></a></li></ul></div><footer class="footer footer__sidebar"><ul class=footer__list><li class=footer__item>&copy;
Geektree0101
2022</li></ul></footer><script type=text/javascript src=/js/medium-zoom.min.602bd2014468bd348112e2aa24f595c530d257a4ed6c335d7baaa6ac9a7ca6fb.js integrity="sha256-YCvSAURovTSBEuKqJPWVxTDSV6TtbDNde6qmrJp8pvs=" crossorigin=anonymous></script></div></aside><main class=wrapper__main><header class=header><div class="animated fadeInDown"><a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false><span aria-hidden=true class=navbar-burger__line></span>
<span aria-hidden=true class=navbar-burger__line></span>
<span aria-hidden=true class=navbar-burger__line></span></a><nav class=nav><ul class=nav__list id=navMenu><li class=nav__list-item><a href=/ title>Index 0</a></li><li class=nav__list-item><a href=/about/ title>About</a></li></ul><ul class="nav__list nav__list--end"><li class=nav__list-item><div class=themeswitch><a title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></li></ul></nav></div></header><div class="post
animated fadeInDown"><div class=post__content><h1>VEditorKit: Lightweight and Powerful Editor Kit (Part 1. NSTextStorage)</h1><p><img src=/images/blog/0__SxvCIXdi445gUH7r.png alt></p><p>Lightweight and Powerful Editor Kit built on Texture(AsyncDisplayKit)</p><p>VEditorKit provides the <strong>most core functionality</strong> needed for the editor. Unfortunately, When <strong>combined words</strong> are entered then UITextView selectedRange will changed and <strong>typingAttribute will cleared</strong>. So, In combined words case, Users can’t continue typing the style they want.</p><p><a href=https://developer.apple.com/documentation/uikit/uitextview/1618629-typingattributes title=https://developer.apple.com/documentation/uikit/uitextview/1618629-typingattributes><strong>typingAttributes - UITextView | Apple Developer Documentation</strong><br>_This dictionary contains the attribute keys (and corresponding values) to apply to newly typed text. When the text…_developer.apple.com</a><a href=https://developer.apple.com/documentation/uikit/uitextview/1618629-typingattributes></a></p><blockquote><p>This dictionary contains the attribute keys (and corresponding values) to apply to newly typed text. <strong>When the text view’s selection changes, the contents of the dictionary are cleared automatically</strong>.</p></blockquote><p><img src=/images/blog/0__Ci6__gbc8tjS1vW1R.jpg alt></p><h4 id=so-how-to-solve-thisissue>So, How to solve this issue?</h4><p>Key points is NSTextStorage!</p><p><a href=https://developer.apple.com/documentation/uikit/nstextstorage title=https://developer.apple.com/documentation/uikit/nstextstorage><strong>NSTextStorage - UIKit | Apple Developer Documentation</strong><br>_A text storage object can be accessed from any thread of your app, but your app must guarantee access from only one…_developer.apple.com</a><a href=https://developer.apple.com/documentation/uikit/nstextstorage></a></p><p>Our Vingle iOS team is missing part is as follows :</p><ul><li>UITextView covers many attribute-related features such as delete, typing with bold, italic, heading, quote attributes</li><li>No dependency separation between typing attribute controller with UITextView</li><li>When the text view’s selection changes, the contents of the dictionary are cleared automatically. But, Our team UITextView apply typing attribute value on a redundant basis after update text.</li></ul><p><a href=https://github.com/GeekTree0101/VEditorKit/blob/master/VEditorKit/Classes/VEditorTextStorage.swift title=https://github.com/GeekTree0101/VEditorKit/blob/master/VEditorKit/Classes/VEditorTextStorage.swift><strong>GeekTree0101/VEditorKit</strong><br>_Lightweight and Powerful Editor Kit (Beta). Contribute to GeekTree0101/VEditorKit development by creating an account on…_github.com</a><a href=https://github.com/GeekTree0101/VEditorKit/blob/master/VEditorKit/Classes/VEditorTextStorage.swift></a></p><p>The above problems were resolved as follows.</p><h3 id=1-define-typing-status--make-currenttypingattribute-property>1. Define typing status & make currentTypingAttribute property</h3><p>enum TypingStstus {<br>case typing<br>case remove<br>case paste<br>case none<br>}</p><p>internal var currentTypingAttribute: [NSAttributedString.Key: Any] = [:]</p><p>currentTypingAttribute replaces UITextView typingAttribute property.</p><p>In this case, How to update internal currentTypingAttribute on NSTextStorage?.</p><p>The solutions are as follows:</p><p>open class VEditorTextNode: ASEditableTextNode, ASEditableTextNodeDelegate {</p><pre><code>open var textStorage: VEditorTextStorage? {   
   return self.textView.textStorage as? VEditorTextStorage      
 }     
  
open var currentTypingAttribute: \[NSAttributedString.Key: Any\] = \[:\] {          
 didSet {  
       self.typingAttributes = currentTypingAttribute  
                               .typingAttribute()  
       self.textStorage?  
           .currentTypingAttribute = currentTypingAttribute  
 }     
</code></pre><p>}</p><p>If you set currentTypingAttribute on TextView then automatically update UITextView typingAttribute with textStorage internal currentTypingAttribute.</p><h3 id=2-set-typingstatus-as-paste-on-setattributedstring>2. Set typingStatus as Paste on setAttributedString:</h3><p>override public func setAttributedString(_ attrString: NSAttributedString) {<br>self.status = .paste<br>super.setAttributedString(attrString)<br>}</p><h3 id=3-set-typingstatus-as-remove-or-typing-on-replacecharacters>3. Set typingStatus as remove or typing on replaceCharacters:</h3><p>override public func replaceCharacters(in range: NSRange, with str: String) {<br>if self.status != .paste {<br>self.status = str.isEmpty ? .remove: .typing<br>}</p><pre><code>self.beginEditing()         
self.internalAttributedString  
    .replaceCharacters(in: range, with: str)          
self.replaceTextString(in: range, with: str)       
self.edited(.editedCharacters,  
            range: range,  
            changeInLength: str.count - range.length)          
self.endEditing()     
</code></pre><p>}</p><p>If status is paste then ignore status updating as remove or typing.</p><p>override public func setAttributes(_ attrs: [NSAttributedString.Key: Any]?, range: NSRange) {</p><pre><code> guard internalAttributedString.length &gt; range.location else {   
      return   
 }           
     
 switch status {        
   case .typing, .paste: break      
   default: return          
 }         
      
 self.beginEditing()  
 self.internalAttributedString  
     .setAttributes(attrs, range: range)  
 self.edited(.editedAttributes, range: range, changeInLength: 0)  
 self.endEditing()      
</code></pre><p>}</p><p>In typing & paste status, after typing text will operate setAttributes methods.</p><h3 id=4-override-processediting>4. override processEditing:</h3><p>override public func processEditing() {<br>switch status {<br>case .typing:<br>guard !self.currentTypingAttribute.isEmpty else { break }<br>self.internalAttributedString<br>.setAttributes(self.currentTypingAttribute,<br>range: self.editedRange)<br>default:<br>break<br>}<br>super.processEditing()<br>}</p><p>In combined character typing status, typingAttribute cleared due to selection changing. But, currentTypingAttribute sustained and will set expected typing attributes. Therefore, The cleared UITextView typingAttribute returns internal currentTypingAttribute on NSTextStorage by UITextView internal system logic.</p><p><img src=/images/blog/1__GPJAsVw4I3XUyPsDEejF9w.gif alt>
<img src=/images/blog/1__ewpzNsWOxjOW8AADYYr3pg.gif alt></p><p><img src=/images/blog/1__6HbBYrl6A4WEKAa8Wh6diQ.png alt></p><p>VEditorKit is looking for contributor who will be thinking about iOS Text editor technology.</p><p><img src=/images/blog/1__GPJAsVw4I3XUyPsDEejF9w.gif alt>
<img src=/images/blog/1__ewpzNsWOxjOW8AADYYr3pg.gif alt>
<img src=/images/blog/1__PRjX2mIls8nOIfx2hRavNg.gif alt></p><p><img src=/images/blog/1__faTeUe8mKcnq9Z8ltt__zUA.gif alt>
<img src=/images/blog/1__9ytvYQ__cRnh7P7FJYxKoYQ.gif alt>
<img src=/images/blog/1__rRnf__vMUta7SUS__7hH2nmw.gif alt></p></div><div class=post__footer><span><a class=category href=/categories/ios/>iOS</a></span>
<span><a class=tag href=/tags/ios/>ios</a><a class=tag href=/tags/vingle/>vingle</a><a class=tag href=/tags/veditorkit/>VEditorKit</a></span></div></div></main></div><footer class="footer footer__base"><ul class=footer__list><li class=footer__item>&copy;
Geektree0101
2022</li></ul></footer><script type=text/javascript src=/js/medium-zoom.min.602bd2014468bd348112e2aa24f595c530d257a4ed6c335d7baaa6ac9a7ca6fb.js integrity="sha256-YCvSAURovTSBEuKqJPWVxTDSV6TtbDNde6qmrJp8pvs=" crossorigin=anonymous></script></body></html>