<!doctype html><html lang=en-us><head>
<meta charset=utf-8>
<title>VEditorKit: Lightweight and Powerful Editor Kit (Part 1. NSTextStorage)</title>
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<meta name=description content="Lightweight and Powerful Editor Kit built on Texture">
<meta name=author content="somrat">
<meta name=generator content="Hugo 0.88.1">
<link rel=preconnect href=https://fonts.gstatic.com>
<link rel=stylesheet href=https://geektree0101.github.io/plugins/bootstrap/bootstrap.min.css>
<link rel=stylesheet href="https://fonts.googleapis.com/css?family=Rubik:300,400,500,700,900&display=swap">
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css>
<link rel=stylesheet href=https://geektree0101.github.io/plugins/hover/hover.css>
<link rel=stylesheet href=https://geektree0101.github.io/plugins/magnific-popup/magnific-popup.css>
<link rel=stylesheet href=https://geektree0101.github.io/plugins/owl-carousel/owl.carousel.min.css>
<link rel=stylesheet href=https://geektree0101.github.io/plugins/owl-carousel/owl.theme.default.min.css>
<link rel=stylesheet href=https://geektree0101.github.io/plugins/text-animation/text-animation.css>
<link rel=stylesheet href=https://geektree0101.github.io/css/style.min.css media=screen>
<link rel=stylesheet href=https://geektree0101.github.io/css/custom.min.css media=screen>
<link rel="shortcut icon" href=https://geektree0101.github.io/images/favicon.png type=image/x-icon>
<link rel=icon href=https://geektree0101.github.io/images/favicon.png type=image/x-icon>
<meta property="og:image" content="https://geektree0101.github.io/images/blog/0__SxvCIXdi445gUH7r.png">
<meta property="og:title" content="VEditorKit: Lightweight and Powerful Editor Kit (Part 1.  NSTextStorage)">
<meta property="og:description" content="Lightweight and Powerful Editor Kit built on Texture">
<meta property="og:type" content="article">
<meta property="og:url" content="https://geektree0101.github.io/blog/blog19/"><meta property="article:section" content="blog">
<meta property="article:published_time" content="2019-01-20T04:23:30+00:00">
<meta property="article:modified_time" content="2019-01-20T04:23:30+00:00">
</head><body>
<div class=preloader>
<img src=https://geektree0101.github.io/images/preloader.gif alt=preloader>
</div>
<section class="menu menu-fix" id=home>
<nav>
<div class="menu-container menu-normal">
<ul class="desktop-menu list-inline mb-0 justify-content-end" id=desktop-menu>
<li class="menu-item menu-item-transparent dark hvr-underline-from-left 1"><a href=https://geektree0101.github.io/>Home</a></li>
<li class="menu-item menu-item-transparent dark hvr-underline-from-left 1"><a href=https://geektree0101.github.io/#blog>Post</a></li>
<li class="menu-item menu-item-transparent dark hvr-underline-from-left 1"><a href=https://geektree0101.github.io/#about>About me</a></li>
</ul>
<div class=mobile-menu>
<a class=menu-link>
<div class=mobile-menu-nav>
<span></span>
<span></span>
<span></span>
</div>
</a>
<div class=menu-slider>
<nav>
<ul class=mobile-menu-list>
<li class="hvr-shutter-out-vertical mobile-menu-item 1"><a href=https://geektree0101.github.io/>Home</a></li>
<li class="hvr-shutter-out-vertical mobile-menu-item 1"><a href=https://geektree0101.github.io/#blog>Post</a></li>
<li class="hvr-shutter-out-vertical mobile-menu-item 1"><a href=https://geektree0101.github.io/#about>About me</a></li>
</ul>
<ul class="mobile-menu-icons list-inline">
<li><a href="https://www.facebook.com/profile.php?id=100009249402427"><i class="fab fa-facebook-f"></i></a></li>
<li><a href=https://github.com/Geektree0101><i class="fab fa-github"></i></a></li>
<li><a href=https://www.linkedin.com/in/hyeonsu-ha-7ba02b112/><i class="fab fa-linkedin"></i></a></li>
</ul>
</nav>
</div>
</div>
</div>
</nav>
</section>
<div style=height:50px></div>
<section class=section>
<div class=container>
<div class=row>
<div class="col-lg-8 mb-4 mb-lg-0">
<div class="wow fadeInUp" data-wow-duration=1.5s>
<img src=https://geektree0101.github.io/images/blog/0__SxvCIXdi445gUH7r.png alt=image class="img-fluid w-100 mb-5">
<div class="about-me-text mb-4">
<h1>VEditorKit: Lightweight and Powerful Editor Kit (Part 1. NSTextStorage)</h1>
</div>
<div class=content><p><img src=/images/blog/0__SxvCIXdi445gUH7r.png alt></p>
<p>Lightweight and Powerful Editor Kit built on Texture(AsyncDisplayKit)</p>
<p>VEditorKit provides the <strong>most core functionality</strong> needed for the editor. Unfortunately, When <strong>combined words</strong> are entered then UITextView selectedRange will changed and <strong>typingAttribute will cleared</strong>. So, In combined words case, Users can’t continue typing the style they want.</p>
<p><a href=https://developer.apple.com/documentation/uikit/uitextview/1618629-typingattributes title=https://developer.apple.com/documentation/uikit/uitextview/1618629-typingattributes><strong>typingAttributes - UITextView | Apple Developer Documentation</strong><br>
_This dictionary contains the attribute keys (and corresponding values) to apply to newly typed text. When the text…_developer.apple.com</a><a href=https://developer.apple.com/documentation/uikit/uitextview/1618629-typingattributes></a></p>
<blockquote>
<p>This dictionary contains the attribute keys (and corresponding values) to apply to newly typed text. <strong>When the text view’s selection changes, the contents of the dictionary are cleared automatically</strong>.</p>
</blockquote>
<p><img src=/images/blog/0__Ci6__gbc8tjS1vW1R.jpg alt></p>
<h4 id=so-how-to-solve-thisissue>So, How to solve this issue?</h4>
<p>Key points is NSTextStorage!</p>
<p><a href=https://developer.apple.com/documentation/uikit/nstextstorage title=https://developer.apple.com/documentation/uikit/nstextstorage><strong>NSTextStorage - UIKit | Apple Developer Documentation</strong><br>
_A text storage object can be accessed from any thread of your app, but your app must guarantee access from only one…_developer.apple.com</a><a href=https://developer.apple.com/documentation/uikit/nstextstorage></a></p>
<p>Our Vingle iOS team is missing part is as follows :</p>
<ul>
<li>UITextView covers many attribute-related features such as delete, typing with bold, italic, heading, quote attributes</li>
<li>No dependency separation between typing attribute controller with UITextView</li>
<li>When the text view’s selection changes, the contents of the dictionary are cleared automatically. But, Our team UITextView apply typing attribute value on a redundant basis after update text.</li>
</ul>
<p><a href=https://github.com/GeekTree0101/VEditorKit/blob/master/VEditorKit/Classes/VEditorTextStorage.swift title=https://github.com/GeekTree0101/VEditorKit/blob/master/VEditorKit/Classes/VEditorTextStorage.swift><strong>GeekTree0101/VEditorKit</strong><br>
_Lightweight and Powerful Editor Kit (Beta). Contribute to GeekTree0101/VEditorKit development by creating an account on…_github.com</a><a href=https://github.com/GeekTree0101/VEditorKit/blob/master/VEditorKit/Classes/VEditorTextStorage.swift></a></p>
<p>The above problems were resolved as follows.</p>
<h3 id=1-define-typing-status--make-currenttypingattribute-property>1. Define typing status & make currentTypingAttribute property</h3>
<p>enum TypingStstus { <br>
case typing <br>
case remove <br>
case paste <br>
case none <br>
}</p>
<p>internal var currentTypingAttribute: [NSAttributedString.Key: Any] = [:]</p>
<p>currentTypingAttribute replaces UITextView typingAttribute property.</p>
<p>In this case, How to update internal currentTypingAttribute on NSTextStorage?.</p>
<p>The solutions are as follows:</p>
<p>open class VEditorTextNode: ASEditableTextNode, ASEditableTextNodeDelegate {</p>
<pre><code>open var textStorage: VEditorTextStorage? {   
   return self.textView.textStorage as? VEditorTextStorage      
 }     
  
open var currentTypingAttribute: \[NSAttributedString.Key: Any\] = \[:\] {          
 didSet {  
       self.typingAttributes = currentTypingAttribute  
                               .typingAttribute()  
       self.textStorage?  
           .currentTypingAttribute = currentTypingAttribute  
 }     
</code></pre>
<p>}</p>
<p>If you set currentTypingAttribute on TextView then automatically update UITextView typingAttribute with textStorage internal currentTypingAttribute.</p>
<h3 id=2-set-typingstatus-as-paste-on-setattributedstring>2. Set typingStatus as Paste on setAttributedString:</h3>
<p>override public func setAttributedString(_ attrString: NSAttributedString) { <br>
self.status = .paste <br>
super.setAttributedString(attrString) <br>
}</p>
<h3 id=3-set-typingstatus-as-remove-or-typing-on-replacecharacters>3. Set typingStatus as remove or typing on replaceCharacters:</h3>
<p>override public func replaceCharacters(in range: NSRange, with str: String) { <br>
if self.status != .paste { <br>
self.status = str.isEmpty ? .remove: .typing <br>
}</p>
<pre><code>self.beginEditing()         
self.internalAttributedString  
    .replaceCharacters(in: range, with: str)          
self.replaceTextString(in: range, with: str)       
self.edited(.editedCharacters,  
            range: range,  
            changeInLength: str.count - range.length)          
self.endEditing()     
</code></pre>
<p>}</p>
<p>If status is paste then ignore status updating as remove or typing.</p>
<p>override public func setAttributes(_ attrs: [NSAttributedString.Key: Any]?, range: NSRange) {</p>
<pre><code> guard internalAttributedString.length &gt; range.location else {   
      return   
 }           
     
 switch status {        
   case .typing, .paste: break      
   default: return          
 }         
      
 self.beginEditing()  
 self.internalAttributedString  
     .setAttributes(attrs, range: range)  
 self.edited(.editedAttributes, range: range, changeInLength: 0)  
 self.endEditing()      
</code></pre>
<p>}</p>
<p>In typing & paste status, after typing text will operate setAttributes methods.</p>
<h3 id=4-override-processediting>4. override processEditing:</h3>
<p>override public func processEditing() {<br>
switch status {<br>
case .typing: <br>
guard !self.currentTypingAttribute.isEmpty else { break }<br>
self.internalAttributedString<br>
.setAttributes(self.currentTypingAttribute,<br>
range: self.editedRange) <br>
default: <br>
break <br>
}<br>
super.processEditing() <br>
}</p>
<p>In combined character typing status, typingAttribute cleared due to selection changing. But, currentTypingAttribute sustained and will set expected typing attributes. Therefore, The cleared UITextView typingAttribute returns internal currentTypingAttribute on NSTextStorage by UITextView internal system logic.</p>
<p><img src=/images/blog/1__GPJAsVw4I3XUyPsDEejF9w.gif alt>
<img src=/images/blog/1__ewpzNsWOxjOW8AADYYr3pg.gif alt></p>
<p><img src=/images/blog/1__6HbBYrl6A4WEKAa8Wh6diQ.png alt></p>
<p>VEditorKit is looking for contributor who will be thinking about iOS Text editor technology.</p>
<p><img src=/images/blog/1__GPJAsVw4I3XUyPsDEejF9w.gif alt>
<img src=/images/blog/1__ewpzNsWOxjOW8AADYYr3pg.gif alt>
<img src=/images/blog/1__PRjX2mIls8nOIfx2hRavNg.gif alt></p>
<p><img src=/images/blog/1__faTeUe8mKcnq9Z8ltt__zUA.gif alt>
<img src=/images/blog/1__9ytvYQ__cRnh7P7FJYxKoYQ.gif alt>
<img src=/images/blog/1__rRnf__vMUta7SUS__7hH2nmw.gif alt></p>
</div>
<div class="tags mt-4 content">
<i class="fas fa-tags mr-2"></i>
<a href=https://geektree0101.github.io/tags/ios>Ios</a>, <a href=https://geektree0101.github.io/tags/vingle>Vingle</a>, <a href=https://geektree0101.github.io/tags/veditorkit>VEditorKit</a>
</div>
</div>
</div>
</div>
</div>
</section>
<footer class="footer-bg fadeInUp wow" data-wow-duration=1.5s>
<div class=container>
<div class=row>
<div class="footer col-lg-10 offset-lg-1">
<hr>
<ul class="footer-icons list-inline">
<li><a href="https://www.facebook.com/profile.php?id=100009249402427"><i class="fab fa-facebook-f"></i></a></li>
<li><a href=https://github.com/Geektree0101><i class="fab fa-github"></i></a></li>
<li><a href=https://www.linkedin.com/in/hyeonsu-ha-7ba02b112/><i class="fab fa-linkedin"></i></a></li>
</ul>
<div class=to-top>
<a href=#home><i class="fa fa-chevron-up"></i></a>
</div>
<div class="credit content">
Copyright © 2021 a hugo theme by <a href=https://somrat.netlify.com>somrat</a>
</div>
</div>
</div>
</div>
</footer>
<script src=https://geektree0101.github.io/plugins/jQuery/jquery.min.js></script>
<script src=https://geektree0101.github.io/plugins/bootstrap/bootstrap.min.js></script>
<script src=https://geektree0101.github.io/plugins/wow.min.js></script>
<script src=https://geektree0101.github.io/plugins/text-animation/text-animation.js></script>
<script src=https://geektree0101.github.io/plugins/jquery.waypoints.min.js></script>
<script src=https://geektree0101.github.io/plugins/shuffle/shuffle.min.js></script>
<script src=https://geektree0101.github.io/plugins/magnific-popup/jquery.magnific-popup.min.js></script>
<script src=https://geektree0101.github.io/plugins/owl-carousel/owl.carousel.min.js></script>
<script src=https://geektree0101.github.io/js/script.min.js></script>
</body>
</html>